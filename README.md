# pb-assignment

#### 1.1 Booking time is defined as the time taken from the leadcreation until the booking status changes to COMPLETED. For each of the cities 'Gurgaon' and 'Noida’, calculate average booking time (in days) for each product for all completed bookings within the last 30 days.
&nbsp;<br>
#### The result should have 3 columns: city_name, product_name, average_booking_time.
```
select cm.city_name, pm.product_name, avg(datediff(bd.completed_at, bd.created_at)) avg_booking_time
from lead_details ld
left join booking_details bd on bd.lead_id = ld.id
left join customer_registration_details crd on crd.id = ld.customer_id
left join product_master pm on pm.id = ld.product_id
left join cities_master cm on cm.id = city_id
where bd.status = 'COMPLETED' and cm.city_name in ('Gurgaon', 'Noida')
and bd.completed_at > (curdate() - interval 30 day)
group by cm.id, pm.id
```
&nbsp;<br>

#### 1.2 For each city (Gurgaon and Noida) and each day of the week, determine the percentage of registrations on a particular day that resulted in a successful lead generation within 24 hours of the user registration.

#### Consider only the first 7 days of 2021 for user-registration.
&nbsp;<br>
#### The result should have 4 columns: city_name, date, total_registrations, percentage_lead_generated.

```
select cm.city_name, date(bd.created_at) created_at,
count(crd.id) total_registrations,
(count(case when db.status = 'COMPLETED' then crd.id else null end)/count(crd.id))*100 percentage_lead_generated
from lead_details ld
left join booking_details bd on bd.lead_id = ld.id
left join customer_registration_details crd on crd.id = ld.customer_id
left join product_master pm on pm.id = ld.product_id
left join cities_master cm on cm.id = city_id
where cm.city_name in ('Gurgaon', 'Noida') and date_format(bd.created_at) between '2021-01-01' and '2021-01-07'
group by date, cm.id
```
---

#### 2A Findings with respect to marketing performance and optimization, suggestions

&nbsp;<br>
[Campaign / Revenue Generation (Click to view)](https://ibb.co/bKhTYjX)


| Campaign | Jan              | Feb              | Mar              | Apr              |
|----------|------------------|------------------|------------------|------------------|
| organic  | ₹ 1,04,01,971.43 | ₹ 2,62,20,983.21 | ₹ 6,01,06,263.40 | ₹ 8,68,17,011.50 |
| source_a | ₹ 10,87,048.41   | ₹ 24,24,114.07   | ₹ 65,38,625.27   | ₹ 98,02,114.10   |
| source_b | ₹ 52,22,398.00   | ₹ 1,18,17,955.84 | ₹ 2,57,84,965.58 | ₹ 3,67,23,819.59 |
| source_c | ₹ 50,23,702.25   | ₹ 1,63,27,209.28 | ₹ 3,07,45,408.90 | ₹ 4,60,83,133.59 |
| source_d | ₹ 62,41,642.59   | ₹ 1,75,07,737.45 | ₹ 4,11,70,738.67 | ₹ 5,67,21,523.78 |

From the above image, it is clear that the revenue generated by campaigns together is ~75% more than the revenue generated by organic method.

For an example, if ₹175 is generated from campaign sources, ₹100 is generated from organic in a month. 

| Campaign | Jan | Feb  | Mar  | Apr | Avg MoM % Rate |
|----------|-----|------|------|-----|----------------|
| organic  | 0%  | 152% | 129% | 44% | 81%            |
| source_a | 0%  | 123% | 170% | 50% | 86%            |
| source_b | 0%  | 126% | 118% | 42% | 72%            |
| source_c | 0%  | 225% | 88%  | 50% | 91%            |
| source_d | 0%  | 180% | 135% | 38% | 88%            |

As we noticed that there's a growth in revenue generation through organically and campaigns, but it is equally important to understand the customer acquistion growth.

[Campaign / Lead Generation (Click to view)]((https://ibb.co/YDhfrrt))

| Campaign | Jan | Feb  | Mar  | Apr | Avg Customer Acquisition % Growth |
|----------|-----|------|------|-----|-----------------------------------|
| organic  | 0%  | 164% | 133% | 42% | 85%                               |
| source_a | 0%  | 143% | 134% | 41% | 80%                               |
| source_b | 0%  | 144% | 121% | 45% | 78%                               |
| source_c | 0%  | 193% | 105% | 42% | 85%                               |
| source_d | 0%  | 181% | 121% | 44% | 86%                               |

But it has to be noted that there's also a cost that is involved in running and maintaining the campaigns like marketing, advertising, promotions etc.,

Organic way doesn't require any marketing, advertising. It would happen through **Brand value**, **Continuous trust in the organization by the customer**, **word of mouth marketing** which has equal value. which implies it doesn't require any CAC.

#### 2B

| product_type  | Average of time_diff | total_customers | Sum of revenue |
|-------------|----------------------|-------------|----------------|
| cancer      | 10                   | 2163        | 304451.76      |
| car         | 2                    | 15408       | 62468250.41    |
| health      | 15                   | 8716        | 16334173.58    |
| investment  | 6                    | 8706        | 4539303.48     |
| term        | 16                   | 15283       | 418515804.5    |
| travel      | 1                    | 2205        | 236571.72      |
| two_wheeler | 1                    | 2200        | 369811.51      |

It can be noticed that the average time diff in a successful lead conversion is high in **Cancer, health** and **term** product types.

**Cancer, health** and **term** is all about securing one's life and lives of their loved ones. It is understandable that why the conversion time difference is high. The user might be taking suggestions from others who had already taken policies, enquiring on how it works from others and other queries before making a payment.

To reduce the time difference in successful conversion, I believe

* Understanding the user pain points is highly important. Delivering the quality pitch from the agents, making the user to understand clearly about the policies, prices and the Insurer.

* Assuming, policyBazaar has also feet-on-street insurance agents. Whenver a user signs up, the telecalling agent could ask the customer whether he could opt in for in-person meeting.

   If an agent could explain about the policies and Insurer, in-person, it would make the user to build trust and long-term relation with PolicyBazaar.

#### 2C

* It can noticed that the number of customerrs are very low in tier-1 cities which resulted in low revenue in tier-1.
* Generally, 21-23 is the age where people starts their career. It can also be noticed that there are customers below 25 years. By this, the awareness and importance of Insurances can been seen in **Gen-Z** age group.


---

#### 3A

```
def get_max_profit(list):
    """  """
    max_profit = 0
    current = 0

    for i in reversed(list):
        current = max(current, i)
        profit = current - i
        max_profit = max(max_profit, profit)

    # print(max_profit)
    return max_profit

list = [10, 7, 5, 8, 11, 9]
get_max_profit(list)
```

#### 3B
pandas \
numpy \
mysql.connector \
PyMySQL \
SQLAchemy \
boto3 \
postmarker 

and other basic standard libraries.

